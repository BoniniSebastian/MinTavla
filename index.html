<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Min tavla</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      padding: 20px;
      background: #fff;
    }
    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    select, input[type="text"] {
      padding: 5px;
      font-size: 16px;
    }
    .section-header {
      margin-top: 24px;
      font-size: 20px;
      font-weight: bold;
    }
    .task-counter {
      font-weight: normal;
      font-size: 14px;
    }
    .task {
      padding: 8px;
      margin: 4px 0;
      background-color: #f1f1f1;
      border-radius: 4px;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
  <h1>
    Min tavla
    <a href="#" style="font-size: 16px; text-decoration: underline; color: purple;">Gemensam <span class="task-counter" id="taskCount">(0)</span></a>
  </h1>

  <div class="toolbar">
    <select id="categorySelect">
      <option value="Alla">Alla</option>
      <option value="Kom ihåg">Kom ihåg</option>
      <option value="Milo">Milo</option>
      <option value="Alice">Alice</option>
      <option value="Sandra">Sandra</option>
      <option value="Sibbe">Sibbe</option>
      <option value="Gemensam">Gemensam</option>
    </select>
    <input type="text" id="taskInput" placeholder="Skriv en uppgift...">
    <button id="addTaskBtn">＋</button>
  </div>

  <div id="sections">
    <div class="section-header">Kom ihåg</div>
    <div id="Kom ihåg"></div>

    <div class="section-header">Milo</div>
    <div id="Milo"></div>

    <div class="section-header">Alice</div>
    <div id="Alice"></div>

    <div class="section-header">Sandra</div>
    <div id="Sandra"></div>

    <div class="section-header">Sibbe</div>
    <div id="Sibbe"></div>

    <div class="section-header">Gemensam</div>
    <div id="Gemensam"></div>

    <div class="section-header">Slutförda uppgifter</div>
    <div id="Slutförda"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC0S1NPzRdkGOKp0IzBfKSvE_845yq0q58",
      authDomain: "vh1-lagtavla.firebaseapp.com",
      databaseURL: "https://vh1-lagtavla-default-rtdb.firebaseio.com",
      projectId: "vh1-lagtavla",
      storageBucket: "vh1-lagtavla.appspot.com",
      messagingSenderId: "145946104646",
      appId: "1:145946104646:web:75a48a1665198ae0644b47",
      measurementId: "G-JDFQWC97PS"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const taskInput = document.getElementById('taskInput');
    const addTaskBtn = document.getElementById('addTaskBtn');
    const categorySelect = document.getElementById('categorySelect');
    const taskCountEl = document.getElementById('taskCount');

    const sectionIds = ["Kom ihåg", "Milo", "Alice", "Sandra", "Sibbe", "Gemensam", "Slutförda"]
    const sectionMap = {};
    sectionIds.forEach(id => sectionMap[id] = document.getElementById(id));

    function addTaskToDOM(task, id) {
      const div = document.createElement('div');
      div.className = 'task';
      div.innerText = task.text;
      if (task.completed) {
        sectionMap["Slutförda"].appendChild(div);
      } else if (sectionMap[task.category]) {
        sectionMap[task.category].appendChild(div);
      }
    }

    function updateTaskCount(tasks) {
      const total = Object.values(tasks).filter(t => !t.completed && t.category === 'Gemensam').length;
      taskCountEl.textContent = `(${total})`;
    }

    addTaskBtn.onclick = () => {
      const text = taskInput.value.trim();
      const category = categorySelect.value;
      if (!text) return;
      const task = { text, category, completed: false, timestamp: Date.now() };
      db.ref('tasks').push(task);
      taskInput.value = '';
    };

    db.ref('tasks').on('value', snapshot => {
      sectionIds.forEach(id => sectionMap[id].innerHTML = '');
      const tasks = snapshot.val() || {};
      Object.entries(tasks).forEach(([id, task]) => addTaskToDOM(task, id));
      updateTaskCount(tasks);
    });
  </script>
</body>
</html>
